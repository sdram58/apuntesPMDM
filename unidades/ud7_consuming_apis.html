<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet data management</title>
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/prism.css">
    <link rel="stylesheet" href="../styles/styles.css">
    <script src="../script/script.js"></script>
</head>
<body>
    <h1>Internet data management</h1>
    <div class="main-menu">
        <a href="#sIntroduction">Introduction</a><a 
           href="#sGlide">Glide</a><a 
           href="#sRetrofit">Retrofit2</a><a
           href="#sVolley">Volley</a><a
           href="#sWebgraphy">Webgraphy</a>
    </div>

    <!--*********************************************************Introduction***********************************************************-->
    <section class="apartado">
    <a name="sIntroduction"></a>
    <h2>Introduction</h2>
    In this topic we will see how to obtain / send information from / to the Internet. For this we will use REST services
    <h3>What is an API Rest?</h3>
    <p>We could define REST API as a service that provides us with the functions we need to be able to obtain information from an external client, 
        such as a database hosted anywhere in the world from within our own application.</p>
    <p>Let's think about Instagram, an application with millions of users. It is not feasible to have the information of each user within the application, right? 
        Well, to solve the problem they use REST API services. The first thing we do when entering the app is a login, this would be the first of the services, 
        since we send the server the <span class="negrita">username</span>  and <span class="negrita">password</span>  and this would return the information that we 
        must show in the app.</p>

    <p>We have four different types of requests as a general rule.</p>
    <ul>
        <li><span class="negrita">Get</span>: These are the simplest requests, <span class="subrayado">they only return information</span>. 
            If we need to pass a parameter to the request, it will be through the url. That is, if, for example, we have to make a request that depends on an id 
            (eg the user's identification), the url would be formed like this https://example.com/information/1, with 1 being the parameter that we pass to it. 
            The problem with this is that it is not very secure to pass sensitive information.</li>
        <li><span class="negrita">Post</span>: Similar to <span class="r-word">Get</span> but the parameters are not passed by url, so it is safer to send information.</li>
        <li><span class="negrita">Put</span>: It is usually used to <span class="subrayado">create</span>  the entity, that is, if we think of a service as access to a database, 
            this would create the user for example.</li>
        <li><span class="negrita">Delete</span>: It would be the last of the four that would allow us to <span class="subrayado">delete</span>  the records from the database</li>
    </ul>
        
    <p>The information usually comes in two different formats, <span class="negrita">XML</span>  or <span class="negrita">JSON</span>. 
        In order not to get too deeply into the subject, we will only talk about <span class="negrita">JSON</span>, which is the most common format and with which 
        we are going to work.</p>
    
    <p class="sub-section">JSON format</p>
    <p><span class="r-word">Json</span>  is a simple text format, it is the acronym for <span class="negrita">JavaScript Object Notation</span>. 
        It is one of the standards for the transfer of information between platforms, it has a very legible form that allows us to understand its content without problem. 
        A simple example would be this.</p>

    <section><pre><code class="language-json">{
  "employees": [
    {
    "id": "1",
    "firstName": "Tom",
    "lastName": "Cruise",
    "photo": "https://jsonformatter.org/img/tom-cruise.jpg"
    },
    {
    "id": "2",
    "firstName": "Maria",
    "lastName": "Sharapova",
    "photo": "https://jsonformatter.org/img/Maria-Sharapova.jpg"
    },
    {
    "id": "3",
    "firstName": "Robert",
    "lastName": "Downey Jr.",
    "photo": "https://jsonformatter.org/img/Robert-Downey-Jr.jpg"
    }
]
}</code></pre>
    </section><br><br>

    <p>Every Json format begins and ends with braces and has a key-value. The employees key contains in turn a list of employee (note that instead of braces it has brackets), 
        which stores id, firstName, lastName and photo. Thus we can pass a large amount of information from one platform to another with some standards that help us 
        simplify the process.</p>
    
    <p>If it is still difficult for you to read these files at the beginning, we can make use of a multitude of websites that simplify the way of seeing it, such as 
        <a class="enlace" target="_blank" href="https://jsoneditoronline.org/">JsonEditOnline</a>.</p>
    
    <figure><img src="UD7/images/ud7-2021-12-13-12-00-34.png" /><br><figcaption></figcaption></figure>
    <br>

    <figure><img src="UD7/images/ud7-2021-12-13-12-01-13.png" /><br><figcaption></figcaption></figure>
    <br>
    
    <p>There are many free APIs (some of them with registration) that we can make use of. It is enough to do a search in Google and find almost the theme that we are looking for.</p>
    
    <p>Here is a small list of APIs</p>
    
    
    <ul>
        <li><a class="enlace" target="_blank" href="https://www.themoviedb.org/movie?language=es-ES">API about movies</a> </li>
        <li><a class="enlace" target="_blank" href="https://swapi.dev/">API about StarWars</a> </li>
        <li><a class="enlace" target="_blank" href="https://developer.marvel.com/">API about Marvel</a> </li>
        <li><a class="enlace" target="_blank" href="https://www.weatherapi.com/">API about weather</a> </li>
    </ul>
    
    </section><!-- End section -->

    <!--*******************************************************Glide*************************************************************-->
    <section class="apartado">
    <a name="sGlide"></a>
    <h2>GLIDE</h2>
    <p>Before starting to see how to access REST services, let's see how to obtain images from the internet with their URL and set it into an ImageView.
    Before continuing, remember that if you want to use an image you must be authorized and respect the copyrights &copy; if you have them.
    Remember that by default, if not indicated otherwise, the resource is protected by copy right &copy;</p>

    <p>We have to do two fundamental things:</p>
    <ul>
       <li>Add Glide dependency.           
           <section class="marco-t file-">
               <span class="icono file"> </span> <span class="negrita">Gradle app</span>
               </section>
           <section class="marco-b">
                   <section><pre><code class="language-kotlin">dependencies {
..............
  implementation 'com.github.bumptech.glide:glide:4.12.0'
}</code></pre>
                   </section>
           </section>
           
       </li>
       <li>Grant Internet access permissions to the application. You can see last versi√≥n <a class="enlace" target="_blank" href="https://github.com/bumptech/glide#download">here</a> 
           <section class="marco-t file-">
               <span class="icono file"> </span> <span class="negrita">Manifest.xml</span>
               </section>
           <section class="marco-b">
                   <section><pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?>
&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.catata.glideexample">

    &lt;uses-permission android:name="android.permission.INTERNET" />
    
    &lt;application
    ............. 
</code></pre>
                   </section>
           </section>
           
       </li>
</ul>

    <p>To show a basic example of using Glide, we will implement a simple application that will load images when the button is pressed.</p>
    
    <figure><img src="./UD7/images/UD7-Glide_app.gif" /><br><figcaption>Using glide</figcaption></figure>
    <br>

    Every time we press the button, the application will make a call via Glide to the page <a class="enlace" target="_blank" href="https://picsum.photos/">https://picsum.photos/</a> .
    This website offers us a random image of a certain size.

    <p>So what we will do is add the listener to the button:</p>
    
    <section><pre><code class="language-kotlin">override fun onViewCreated (view: View, savedInstanceState: Bundle?) {
    super.onViewCreated (view, savedInstanceState)

    binding.btnChangeImage.setOnClickListener {
        changeImage ()
    }
}</code></pre>
    </section><br><br>

    <p>Create the <span class="d-word">changeImage</span>  function</p>
     

    <section><pre><code class="language-kotlin">private fun changeImage() {
    val url = "https://picsum.photos/200?rand=" + Random.nextInt()
    Glide.with(requireContext())
        .load(url) //Image that we want to show
        .placeholder(getDrawable(requireContext(),R.drawable.loading)) //Image that will be displayed while loading the image to be displayed
        .error(ERROR_IMAGE) //Image that we will show if something goes wrong. it is typically use a drawable image stored
        .into(binding.ivImage) //ImageView that will contain the image
}</code></pre>
</section><br><br>

    <p>As you can see, we have added a random parameter to the url, this is simply so that it interprets that it is a different url and not take it from the cache.</p>
     
    
    <p>To use Glide we use its methods:</p>
    <ul>
        <li><span class="negrita">with</span> , to which the context is passed.</li>
        <li><span class="negrita">load</span>  the location of the image to be loaded, it does not have to be a url on the internet.</li>
        <li><span class="negrita">Placeholder</span>  tells us which image to display while the image is loading.</li>
        <li><span class="negrita">error</span>  tells us which image to show in case the image cannot be loaded</li>
        <li><span class = "bold"> into </span> tells us where to load that image.</li>
    </ul>
    
    <p>Mandatory are only the <span class="r-word">with</span> , the <span class="r-word">load</span>  and the <span class="r-word">into</span> .</p>

    
    
    <p>Alternatively we can add how we want the image to be displayed inside the ImageView using methods like <span class="r-word">centerCrop()</span>, 
        <span class="r-word">centerInside()</span> , <span class="r-word">fitCenter()</span>. I encourage you to try them.</p>

    
    <p><a class="enlace" target="_blank" href="https://github.com/sdram58/PMDM2021/tree/master/GlideExample">Here</a> you can see the complete example</p>

    <h3> Picasso </h3>

   <p>Also comment that there is another fantastic library to obtain images from the Internet called
 <a class="enlace" target="_blank" href="https://square.github.io/picasso/">Picasso</a> . I also recommend that you take a look at it.
    A basic use would be this.</p>
   
    <section><pre><code class="language-kotlin">Picasso.get().load(url).into (imageView)</code></pre>
    </section><br><br>

    <p>As you can see, it is very similar to using Glide.</p>
    
        
    </section><!-- End section -->


    <!--*********************************************************Retrofit 2***********************************************************-->
    <section class="apartado">
        <a name="sRetrofit"></a>
        <h2>Retrofit 2</h2>
        
        <p>In this section we are going to create a complete app, it is a dog finder. 
            That is, in the search engine we are going to put a breed of dog (in English) and we will retrieve images of that breed that we will show in a RecyclerView,
             that is, we will access the internet to show images that our app does not have.</p>
        
        <p>The API, that we will use, will be <a class="enlace" target="_blank" href="https://dog.ceo/dog-api/">Dog API</a> , it is completely free and has a simple and 
            practical documentation. If we go to documentation we can see all the types of call that there are, we will be interested in only one <span class="negrita">By breed</span>.</p>

        <p>The call will be as follows:</p>
        
        <section><pre><code class="language-kotlin">https://dog.ceo/api/breed/hound/images</code></pre>
        </section><br><br>

        <p>Note that if you open it in the browser itself, a <span class="negrita">JSON</span>  similar to this one will appear</p>

        <section><pre><code class="language-kotlin">// 20211215104051
// https://dog.ceo/api/breed/hound/images
{
    "message": [
        "https://images.dog.ceo/breeds/hound-afghan/n02088094_1003.jpg",
        "https://images.dog.ceo/breeds/hound-afghan/n02088094_1007.jpg",
        "https://images.dog.ceo/breeds/hound-afghan/n02088094_1023.jpg",
        "https://images.dog.ceo/breeds/hound-afghan/n02088094_10263.jpg",
        .......
        ],
  "status": "success"
}</code></pre>
        </section><br><br>
    
    <p>And this is basically what our app will do. 
        You will access the internet, make a request similar to this to retrieve the information, and then modify it so that our application can understand and paint it.
    </p>
    
    <p>The first thing we will do is create a new project called, for instance, <span class="negrita">DogList</span>.</p>
    
    <p>Once we have our project created we will have to request internet access, since our app will connect to consume the API that we discussed earlier.</p>
    
    <p>For this we go to the <span class="inline-file">AndroidManifest.xml</span> file of our project and at the top we add the necessary permission.</p>

    <section><pre><code class="language-xml">&lt;uses-permission android:name="android.permission.INTERNET"/></code></pre>
    </section><br><br>

    <p>The next step will be to import the necessary libraries that we will use in our app. 
        As always all these libraries are added in the <span class="negrita">build.gradle</span>  file of the app module</p>

    <p>The libraries that we are going to import are the following:</p>
    
    <ul>
        <li><span class="negrita">Picasso</span>: This library will allow us to transform those urls into images.</li>
        <li><span class="negrita">Retrofit 2</span> : Library in charge of API consumption.</li>
        <li><span class="negrita">Retrofit 2 Converter Gson</span>: This tool will be a complement to the previous one and will simplify the process of passing a JSON 
            to a Data Class, which is what we will work with in our project.</li>
        <li><span class="negrita">Coroutines</span> : Among many other things, it will allow us to make <span class="d-word">Retrofit</span> requests in the <span class="negrita">background</span>
             so as not to block the user interface.</li>
    </ul>
    
    <p>As you know, the libraries are being updated, worse today the latest versions are the ones that I am going to put here</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">gradle app</span>
        </section>
    <section class="marco-b">
<section><pre><code class="language-kotlin">..............
    buildFeatures{
        viewBinding  true
    }
}


dependencies {

    implementation 'androidx.core:core-ktx:1.6.0'
    implementation 'androidx.appcompat:appcompat:1.3.1'
    implementation 'com.google.android.material:material:1.4.0'
    implementation 'androidx.constraintlayout:constraintlayout:2.1.1'

    testImplementation 'junit:junit:4.+'
    androidTestImplementation 'androidx.test.ext:junit:1.1.3'
    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'

    //PICASSO
    implementation 'com.squareup.picasso:picasso:2.71828'

    //RETROFIT
    implementation 'com.squareup.retrofit2:retrofit:2.9.0'
    implementation "com.squareup.retrofit2:converter-gson:2.9.0"

    //Coroutines
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.1")
}</code></pre>
            </section>
    </section> <br><br>
    
    <p>Don't forget to enable the <span class="negrita">viewBinding</span> and sync up </p>
    
    <p>Now it is time to go to our <span class="d-word">MainActivity</span> and we will finish implementing the <span class="negrita">View Binding</span>.</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">MainActivity</span>
        </section>
    <section class="marco-b">
           <section><pre><code class="language-kotlin">class MainActivity : AppCompatActivity() {
    private lateinit var binding: ActivityMainBinding
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
    }
    
}</code></pre>
           </section><br><br> 
    </section>
    
    <p>The next thing will be to create the view. We are going to <span class="inline-file">activity_main.xml</span> and we will add two components, 
        a <span class="r-word">RecyclerView</span>  that we already know and a <span class="r-word">SearchView</span>, a very simple component that will allow us to implement a 
        quick search engine.</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">activity_main.xml</span>
        </section>
    <section class="marco-b">
            <section><pre><code class="language-xml">&lt;?xml version="1.0" encoding="utf-8"?>
&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/viewRoot"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    &lt;androidx.appcompat.widget.SearchView
        android:id="@+id/svDogs"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        app:layout_constraintVertical_bias="0"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    &lt;androidx.recyclerview.widget.RecyclerView
        android:id="@+id/rvDogs"
        android:layout_width="0dp"
        android:layout_height="0dp"
        app:layout_constraintTop_toBottomOf="@+id/svDogs"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintBottom_toBottomOf="parent"/>

&lt;/androidx.constraintlayout.widget.ConstraintLayout></code></pre>
            </section>
    </section>
    
    <h3>From Json to Data Class</h3>

    <p>We already have almost all the visual part of the app in a moment, but now we have to move on to our data model. 
        That is, remember that <span class="subrayado">the API will return a <span class="negrita">JSON</span> </span>  to us and we have to convert it 
        into a <span class="negrita">Data class</span> .</p>
    
    <p>For this we have to look at the <span class="negrita">JSON structure</span>  of our API, in this case it is quite simple. 
        To begin we have a message field that is basically a <span class="subrayado">list of <span class="cursiva">Strings</span> </span> , they are image urls but they are only text 
        and we also have the status field that will contain the success value if everything has gone well so it will be another <span class="cursiva">String</span> .</p>

    <p>We are going to create a new class, in the same directory where we have the <span class="r-word">MainActivity</span>  we right click <span class="d-word">New> Kotlin File / Class</span> 
         and we will call it <span class="d-word">DogsResponse</span>. Before push enter make sure to select <span class="cursiva">Class</span> </p>
    
    <figure><img src="UD7/images/ud7-2021-12-15-16-41-50.png" /><br><figcaption>Creating our Data Class</figcaption></figure>
    <br>
    
    <p>To convert our class into a data class we will only have to add the reserved word <span class="negrita">data</span>  before <span class="negrita">class</span> 
         and we will get an error because we will have to remove the curly braces and it must have at least one parameter, 
         in this case we will put the two that we've mentioned above.</p>
    
    <section><pre><code class="language-kotlin">data class DogsResponse(var status: String, var message: List&lt;String>)</code></pre>
    </section><br><br>
    <p>This is how our class would look, notice that the name of the fields is exactly the same as that of the JSON, it is mandatory to be able to retrieve the information from the JSON and pass it to our data model.</p>
    
    <p>But here I see a problem and that is that I do not like this name <span class="negrita">message</span>  since it does not seem descriptive, 
        but as I have commented, the name has to be <span class="subrayado"><span class="negrita">exactly the same as the JSON</span></span>. 
        Obviously there is a solution to this dilemma and that is to use the <span class="r-word">SerializedName</span>  annotation, this annotation will make us a "bridge" 
        between the <span class="negrita">required name</span>  and <span class="negrita">the name we want to use</span> .</p>
    
    <section class="marco-t file-">
        <span class="icono file"> </span> <span class="negrita">DogResponse.kt</span>
        </section>
    <section class="marco-b">
        <section><pre><code class="language-kotlin">import com.google.gson.annotations.SerializedName

data class DogResponse(
    @SerializedName("status") var status: String,
    @SerializedName("message") var images: List&lt;String>)</code></pre>
        </section><br><br>
    </section>
    
    
        </section><!-- End section -->


    <!--*********************************************************Volley***********************************************************-->
    <section class="apartado">
    <a name="sVolley"></a>
    <h2>Volley</h2>
    
    
    
    </section><!-- End section -->

    

    <!--*********************************************************Webgraphy***********************************************************-->
    <section class="apartado">
    <a name="sWebgraphy"></a>
    <h2>Webgraphy</h2>
    
    <ul>
        <li><a class="enlace" target="_blank" href="https://github.com/bumptech/glide">Glide</a> </li>
        <li><a class="enlace" target="_blank" href="https://developer.android.com/training/volley">Volley</a> </li>
        <li><a class="enlace" target="_blank" href="https://square.github.io/retrofit/">Retrofit</a> </li>
        <li>
            <a class="enlace" target="_blank" href="https://cursokotlin.com/tutorial-retrofit-2-en-kotlin-con-corrutinas-consumiendo-api-capitulo-20-v2/">Retrofit tutorial</a> 
        </li>

    </ul>
    
    
    </section><!-- End section -->

    <script src="../script/prism.js"></script>
</body>
</html>
