<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UD12.- Introducción a Firebase</title>
  <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
  <link rel="stylesheet" href="../styles/prism.css">
  <link rel="stylesheet" href="../styles/styles.css">
  <script src="../script/script.js"></script>
</head>

<body class="line-numbers">
  <div class="logos"></div>

  <nav id="menu-lateral" class="main-menu-lateral oculto">
    <div class="fila">
      <a href="#sIntroduccion" title="1.- Introducción">1.- Introducción</a>
      <a href="#sAccesoaFirebase" title="2.- Acceso a Firebase">2.- Acceso a Firebase</a>
      <a href="#sIntegraciondeFirebaseenlaaplicacion" title="3.- Integración de Firebase en la aplicación">3.- Integración de Firebase en la aplicación</a>
    </div>
    <div class="fila">
      <a href="#sAnalytics" title="4.- Analytics">4.- Analytics</a>
      <a href="#sAutenticacion" title="5.- Autenticación">5.- Autenticación</a>
      <a href="#sNotificaciones" title="6.- Notificaciones">6.- Notificaciones</a>
    </div>
    <div class="fila">
      <a href="#sCrashlytics" title="7.- Crashlytics">7.- Crashlytics</a>
      <a href="#sConfiguracionRemota" title="8.- Configuración remota">8.- Configuración remota</a>
      <a href="#sBases_de_datos" title="9.- Bases de datos">9.- Bases de datos</a>
    </div>
    
  </nav> <!-- BTM_MENU-->

  <h1>UD12.- Introducción a Firebase</h1>  

  <div class="main-menu">
    <div class="fila">
      <a href="#sIntroduccion" title="1.- Introducción">1.- Introducción</a>
      <a href="#sAccesoaFirebase" title="2.- Acceso a Firebase">2.- Acceso a Firebase</a>
      <a href="#sIntegraciondeFirebaseenlaaplicacion" title="3.- Integración de Firebase en la aplicación">3.- Integración de Firebase en la aplicación</a>
    </div>
    <div class="fila">
      <a href="#sAnalytics" title="4.- Analytics">4.- Analytics</a>
      <a href="#sAutenticacion" title="5.- Autenticación">5.- Autenticación</a>
      <a href="#sNotificaciones" title="6.- Notificaciones">6.- Notificaciones</a>
    </div>
    <div class="fila">
      <a href="#sCrashlytics" title="7.- Crashlytics">7.- Crashlytics</a>
      <a href="#sConfiguracionRemota" title="8.- Configuración remota">8.- Configuración remota</a>
      <a href="#sBases_de_datos" title="9.- Bases de datos">9.- Bases de datos</a>
    </div>
  </div>

  
  <!--*********************************************************Introducción***********************************************************-->
  <section class="apartado">
  <a name="sIntroduccion"></a>
  <h2>Introducción</h2>
  
<p><span class="d-word">Firebase</span> es una plataforma creada por Google en 2014 para ayudar a los desarrolladores en la creación de aplicaciones.</p>

<p>Está disponible para juegos Android, aplicaciones iOS y Android, aplicaciones web y aplicaciones Unity.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-00-05.png" /><br><figcaption></figcaption></figure>
<br>

<p>La página oficial de Firebase es: <a class="enlace" target="_blank" href="https://firebase.google.com/">https://firebase.google.com/</a></p>

<p>Sus características principales son:
<ul>
  <li><span class="negrita">Desarrollo</span>: gracias a las funcionalidades que ofrece permite la creación de mejores aplicaciones minimizando el tiempo de optimización y desarrollo.</li>

<li><span class="negrita">Analítica</span>: ofrece una serie de métricas que permiten un análisis exhaustivo de la aplicación.</li>

<li><span class="negrita">Crecimiento</span>: permite gestionar todos los usuarios de las aplicaciones. Incluye invitaciones, notificaciones…</li>

<li><span class="negrita">Monetización</span>: permite añadir elementos para monetizar la aplicación.</li>

<li><span class="negrita">Rapidez</span>: la API de Firebase es intuitiva y sencilla de usar.</li>

<li><span class="negrita">Agilidad</span>: ofrece herramientas disponibles a diferentes plataformas desde un mismo lugar.</li>
</ul>

</p>

<p>La plataforma proporciona diferentes servicios como:
  <ul>
    <li>Autenticación (Google, X (Twitter), Apple, usuarios propios).</li>
    <li>Almacenamiento en la nube.</li>
    <li>Hosting.</li>
    <li>Bases de datos.</li>
    <li>…</li>
  </ul>
</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-03-08.png" /><br><figcaption></figcaption></figure>
<br>
<p>Firebase es gratis con ciertos límites.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-03-44.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-03-55.png" /><br><figcaption></figcaption></figure>
<br>

<p><a class="enlace" target="_blank" href="https://firebase.google.com/pricing">Aquí</a> tienes todos los límites en los servicios</p>

<p>En el apartado de <span class="negrita">documentación</span> se puede encontrar todo lo necesario para la integración de Firebase en una aplicación. </p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-05-26.png" /><br><figcaption></figcaption></figure>
<br>

<p>Si una aplicación va a hacer uso de Firebase <span class="subrayado">debe tener permisos de acceso a internet</span> en el archivo del <span class="inline-file">AndroidManifest.xml</span>
	<span class="negrita">manifest &rarr; AndroidManifest.xml</span> con la siguiente línea:
</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-33-09.png" /><br><figcaption></figcaption></figure>
<br>

<p>En esta unidad se van a ver ejemplos de los siguientes servicios de Firebase:
  <ul>
    <li>Autenticación.</li>
    <li>Notificaciones Push.</li>
    <li>Crashlytics.</li>
    <li>Configuración remota.</li>
    <li>Bases de datos.</li>
  </ul>
</p>

<h3>Descarga de responsabilidad (Disclaimer)</h3>
<p>Firebase es una plataforma viva que va cambiando adaptándose a las necesidades de cada momento.</p>

<p>También va introduciendo nuevos mecanismos y tecnologías para su uso.</p>

<p>Por ello, en este documento se encuentran pequeñas muestras de cómo usar algunos de sus servicios. Estas pequeñas muestras pueden no estar actualizadas y pueden no mostrar todas las capacidades de la plataforma.</p>

<p>Si se quiere aprender más sobre Firebase se recomienda navegar por su documentación y ejemplos.</p>

</section><!-- End section Introducción-->

<!--*********************************************************Acceso a Firebase***********************************************************-->
<section class="apartado">
<a name="sAccesoaFirebase"></a>
<h2>Acceso a Firebase</h2>

<p>Para acceder a Firebase se debe utilizar una <span class="negrita">cuenta de Google</span> para iniciar sesión y a continuación se debe ir a la <span class="d-word">consola</span>.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-35-48.png" /><br><figcaption></figcaption></figure>
<br>

<p>También se puede acceder directamente a la siguiente URL e iniciar sesión con una cuenta de Google 
  <a class="enlace" target="_blank" href="https://console.firebase.google.com/">https://console.firebase.google.com/</a>.</p>

<p>Una vez se ha accedido a la consola se debe crear un nuevo proyecto siguiendo las instrucciones.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-37-47.png" /><br><figcaption></figcaption></figure>
<br>

<p>Para crear un proyecto se le debe <span class="negrita">dar nombre</span> que no exista previamente (la plataforma avisará en ese caso), 
  en el siguiente paso se pregunta sobre el uso de <span class="negrita">Google Analytics</span> y por último se debe <span class="negrita">crear/elegir una cuenta para Google Analytics</span>.
</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-38-30.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-39-15.png" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez finalizada la creación del proyecto se tendrá disponible la consola</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-40-52.png" /><br><figcaption></figcaption></figure>
<br>

</section><!-- End section Acceso a Firebase-->  

<!--*********************************************************Integración de Firebase en la aplicación***********************************************************-->
<section class="apartado">
<a name="sIntegraciondeFirebaseenlaaplicacion"></a>
<h2>Integración de Firebase en la aplicación</h2>

<p><span class="negrita">Tras crear un proyecto en Android Studio</span> para integrar Firebase a la aplicación 
  se debe ir a la consola del proyecto de Firebase y seleccionar el tipo de aplicación.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-11-43-30.png" /><br><figcaption></figcaption></figure>
<br>

<p>La integración de Firebase en la aplicación consta de varios pasos.
  <ul>
    <li>El primero consiste en registrar la aplicación:</li>
    <li>Nombre del paquete.</li>
    <li>Alias de la app (nombre de la app).</li>
    <li>Certificado SHA-1.</li>
  </ul>
</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-03-55.png" /><br><figcaption></figcaption></figure>
<br>


<p>Una buena práctica es añadir el nombre del proyecto en el elemento <span class="negrita">package</span> del <span class="negrita">manifiesto</span> del proyecto de Android Studio:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-01-48.png" /><br><figcaption></figcaption></figure>
<br>


<p>Para obtener la <span class="d-word">firma SHA-1</span> (huella digital) 
  se puede ejecutar el siguiente comando desde la consola de gradle: <span class="negrita">gradle signingReport</span></p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-04-35.png" /><br><figcaption></figcaption></figure>
<br>

<p>Al ejecutar el comando, en la pestaña <span class="negrita">Run</span> se obtendrán las diferentes claves de firma:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-07-58.png" /><br><figcaption></figcaption></figure>
<br>

<p>Tras conseguir la firma <span class="negrita">SHA-1</span> desde Android Studio se debe volver a configurar que se ejecute la aplicación.</p>

<p>Si no se realiza este cambio, al pulsar el botón "Play" se volverá a ejecutar el comando <span class="negrita">gradle</span> anterior.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-10-28.png" /><br><figcaption></figcaption></figure>
<br>

<p>Si se añade el <span class="negrita">gradle</span> al <span class="negrita">path</span> del sistema también se podrá ejecutar el comando 
  gradle <span class="d-word">signingReport</span> desde la terminal del sistema o de Android Studio.</p>

<p>El siguiente paso consiste en descargar desde firebase console el <span class="negrita">archivo de configuración</span> y añadirlo al proyecto Android Studio.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-25-05.png" /><br><figcaption></figcaption></figure>
<br>

<p>Tal como nos indica el asistente se debe descargar en la raíz del proyecto.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-27-24.png" /><br><figcaption></figcaption></figure>
<br>

<p>En el siguiente paso se debe añadir en <span class="inline-file">build.gradle.kts (Project)</span> la dependencia de Firebase .</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-28-12.png" /><br><figcaption></figcaption></figure>
<br>

<p>También se debe añadir en <span class="inline-file">build.gradle.kts (Module)</span> la dependencia de Firebase .</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-29-35.png" /><br><figcaption></figcaption></figure>
<br>

<p>En este punto se debe sincronizar para que descargue las dependencias.</p>
<p>Una vez configurada la integración ya se podrá consultar la aplicación en la consola de Firebase.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-31-12.png" /><br><figcaption></figcaption></figure>
<br>
<p>Aplicación ya integrada con el proyecto de Firebase.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-32-01.png" /><br><figcaption></figcaption></figure>
<br>

<p>Desde Android Studio hay disponible una opción: <span class="negrita">Menú &rarr; Tools &rarr; Firebase </span></p>
<p>Mediante esta opción se pueden configurar el proyecto para el uso de Firebase de manera automática.</p>
<p>Estas opciones abren flujos de trabajo automáticos entre Android Studio y la aplicación web Firebase.</p>
<p>En algunas opciones se deberá completar la configuración de manera manual, como por ejemplo, el añadir la clave SHA-1 en la aplicación web de Firebase.</p>

<p>Estando ya la aplicación ingtgrada con Firebase como se ha indicado anteriormente:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-34-02.png" /><br><figcaption></figcaption></figure>
<br>
<p>Al pulsar en una opción no configurada aún:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-35-20.png" /><br><figcaption></figcaption></figure>
<br>
<p>Aunque se puede usar este asistente, los ejemplos de clase se realizarán de manera manual para comprender todos los pasos que hay que realizar.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-36-55.png" /><br><figcaption></figcaption></figure>
<br>
<p>El asistente de Firebase integrado en Android Studio ofrece ejemplos de recopilación de datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-37-33.png" /><br><figcaption></figcaption></figure>
<br>


</section><!-- End section Integración de Firebase en la aplicación-->

<!--*********************************************************Analytics***********************************************************-->
<section class="apartado">
<a name="sAnalytics"></a>
<h2>Analytics</h2>
<p>Al integrar la aplicación con Firebase, se añade la dependencia para el análisis de datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-38-43.png" /><br><figcaption></figcaption></figure>
<br>
<p>De esta manera la aplicación enviará a Firebase todos los datos necesarios para poder calcular las diferentes métricas de análisis:
  <li>Número de usuarios.</li>
  <li>Ubicación de los usuarios.</li>
  <li>Plataforma de acceso.</li>
  <li>…</li>
</p>

<p>Por defecto, Firebase registra los eventos de la siguiente página web para las métricas:
<a class="enlace" target="_blank" href="https://support.google.com/analytics/answer/9234069">https://support.google.com/analytics/answer/9234069</a></p>

<p>Solo con iniciar la aplicación en el emulador ya se pueden consultar los datos de análisis:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-48-52.png" /><br><figcaption></figcaption></figure>
<br>
<p>Analytics monitoriza automáticamente una serie de eventos que se pueden consultar directamente:
  <a class="enlace" target="_blank" href="https://support.google.com/analytics/topic/13367566">https://support.google.com/analytics/topic/13367566</a>
</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-12-49-19.png" /><br><figcaption></figcaption></figure>
<br>

<h3>Eventos</h3>
<p>Desde el código de la aplicación se pueden enviar <span class="negrita">eventos personalizados</span> al sistema <span class="negrita">Analytics</span>.</p>
<section><pre><code class="language-kotlin">//Creación instancia de FirebaseAnalytics
val analytics = Firebase.analytics

analytics.logEvent(
    name = "Configuration",
    block = {
        param("Configuration", "Integración con Firebase completada")
        param("Main_Activity", "Cargada la pantalla principal")
    }
)</code></pre>
</section><br><br>
<p>Un evento personalizado debe tener un <span class="negrita">nombre</span>
   y un bloque de datos que sean <span class="negrita">pares clave-valor</span> (al menos un par clave-valor).</p>

<p>Con el código anterior se puede forzar el envío de eventos existentes y el uso de nombres de parámetros existentes.</p>
   

<p>Para ello se usa la clase FirebaseAnalytics, por ejemplo para enviar la pantalla a la que se accede:
     <span class="d-word">FirebaseAnalytics.Event.SCREEN_VIEW</span></p>

   <figure><img src="UD12/images/ud_Firebase-2024-03-20-13-09-48.png" /><br><figcaption></figcaption></figure>
   <br>
<p>Según la documentación de Firebase desde la integración de la aplicación y la generación de los eventos, pueden pasar 24 horas hasta que se muestren en la plataforma.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-11-58.png" /><br><figcaption></figcaption></figure>
<br>


</section><!-- End section Analytics-->

<!--*********************************************************Autenticación***********************************************************-->
<section class="apartado">
<a name="sAutenticacion"></a>
<h2>Autenticación</h2>

<p>Firebase ofrece diversas opciones de autenticación que permiten crear en una aplicación un sistema de registro y login de manera rápida.</p>


<p>Entre todas las opciones de autenticación se encuentran
  <ul>
    <li>Métodos <span class="negrita">nativos</span>:
      <ul>
        <li>Correo electrónico </li>
        <li>Número de teléfono</li>
        <li>Anónimo</li>
      </ul>
    </li>
    <li>
      Métodos de <span class="negrita">terceros</span>:
      <ul>
        <li>Google</li>
        <li>Apple </li>
        <li>Z (Twitter) </li>
        <li>GitHub </li>
        <li>…</li>
      </ul>
    </li>
    <li>
      Métodos <span class="negrita">personalizados</span>:
      Requieren del desarrollo propio del sistema de autenticación en alguna plataforma externa.

    </li>
  </ul>
</p>

<p>Mediante estos métodos de autenticación el desarrollador puede desentenderse de toda la gestión de almacenamiento de dichos datos.</p>
<p>Firebase ofrece diversas opciones de autenticación:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-20-15.png" /><br><figcaption></figcaption></figure>
<br>

<p>En la pestaña Users se pueden consultar los usuarios autenticados, evidentemente en este momento esta pestaña está vacía.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-20-35.png" /><br><figcaption></figcaption></figure>
<br>
<p>En el resto de pestañas se pueden configurar las diferentes opciones.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-31-05.png" /><br><figcaption></figcaption></figure>
<br>
<p>En este curso solo se verá dos de los sistemas de autenticación: <ul>
  <li>Correo electrónico y contraseña.</li>
  <li>Google</li>
</ul>
</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-31-56.png" /><br><figcaption></figcaption></figure>
<br>
<section class="marco-t warn">
  <span class="icono warning"> </span> <span class="negrita">Advertencia</span>: <br>

Se recomienda que todas las tareas de registro y autenticación se realicen en segundo plano mediante funciones suspendidas..

De esta forma la aplicación no se quedará bloqueada si el acceso a internet es lento o si ocurre algún problema en el proceso.

  </section>
<section class="marco-b">
    
</section>
<h3>Autenticación por correo electrónico y contraseña</h3>
<p>Se debe habilitar el proveedor de correo y contraseña en la <span class="negrita">consola de Firebase</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-33-23.png" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez habilitado el proveedor de correo electrónico ya se podrá usar en los proyectos Android Studio.</p>

<p>Además de las dependencias añadidas anteriormente, es necesario añadir la siguiente dependencia en <span class="inline-file">build.gradle.kts (Module)</span>
   y sincronizar.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-34-10.png" /><br><figcaption></figcaption></figure>
<br>

<p>A continuación, se deben diseñar las diferentes pantallas necesarias para poder registrarse y hacer login en la aplicación.</p>
<p class="sub-section">Registro de usuario</p>

<p><span class="negrita">Tras obtener los datos de registro del usuario desde los campos de la aplicación</span>, 
  para registrar al usuario en el sistema se debe usar el siguiente método pasándole como parámetros el usuario y 
  la contraseña de al menos 6 caracteres (en el ejemplo se usan literales).</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-35-48.png" /><br><figcaption></figcaption></figure>
<br>
<p>Se puede añadir el método <span class="r-word">addOnCompleteListener</span>
   que se ejecutará al completar el registro para conocer si el registro ha sido correcto o no.</p>
<p>Por ejemplo, será incorrecto si el email ya está registrado. </p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-36-26.png" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez registrado el usuario se podrá consultar en la consola de Firebase:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-37-06.png" /><br><figcaption></figcaption></figure>
<br>

<p class="sub-section">Inicio de sesión</p>

<p>Tras <span class="negrita"> obtener los datos de acceso (login) del usuario desde los campos de la aplicación</span>, 
  para comprobar si las credenciales son correctas se debe usar el siguiente método pasándole como parámetros el 
  usuario y la contraseña (en el ejemplo se usan literales).</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-37-48.png" /><br><figcaption></figcaption></figure>
<br>
<p>Se puede añadir el método <span class="r-word">addOnCompleteListener</span>
   que se ejecutará al completar el inicio de sesión para conocer si ha sido correcto o no.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-38-25.png" /><br><figcaption></figcaption></figure>
<br>
<p class="sub-section">Acceso a los datos del usuario registrado</p>

<p>Una vez que el usuario se ha registrado con éxito, se puede utilizar la variable <span class="r-word">auth</span> creada para acceder a sus datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-39-03.png" /><br><figcaption></figcaption></figure>
<br>

<p>Y también para para modificarlos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-39-29.png" /><br><figcaption></figcaption></figure>
<br>
 <p class="sub-section">Cerrar sesión</p>
 <p>Para cerrar la sesión del usuario se debe usar el método <span class="r-word">signOut</span> sobre la variable <span class="r-word">auth</span> creada.</p>
 <figure><img src="UD12/images/ud_Firebase-2024-03-20-13-40-13.png" /><br><figcaption></figcaption></figure>
 <br>
 
 <h3>Autenticación con una cuenta de Google</h3>

 <p>La autenticación de Firebase con Google permite tres opciones:
  <ul>
    <li>Utilizar las credenciales ya almacenadas en el dispositivo.</li>
    <li>Añadir unas credenciales nuevas de un correo ya existente.</li>
    <li>Añadir unas credenciales nuevas a partir de un nuevo registro en Google.</li>
  </ul>
 </p>
 
<p>Cuando se utiliza la autenticación de Firebase con Google, se abrirá una ventana nueva en el dispositivo en la que se deberá elegir una de estas opciones.</p>
<p>Se debe habilitar el proveedor de Google en la consola de Firebase</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-42-15.png" /><br><figcaption></figcaption></figure>
<br>

<p>Tras habilitar el proveedor de Google se debe volver a descargar el archivo <span class="inline-file">google-services.json</span>
   desde la configuración del proyecto de Firebase y sustituirlo en el proyecto de Android Studio</p>
<figure><img src="UD12/images/google-services-json.gif" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez habilitado el proveedor de Google ya se podrá usar en los proyectos Android Studio.</p>
<p>Además de las dependencias añadidas anteriormente, es necesario añadir la siguiente dependencia en <span class="inline-file">build.gradle.kts (Module)</span> y sincronizar.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-47-55.png" /><br><figcaption></figcaption></figure>
<br>

<p>Para el funcionamiento de la autenticación con cuenta de Google es 
  necesario el <span class="negrita">identificador de la aplicación</span> que se encuentra en el archivo <span class="inline-file">google-services.json</span>
   y también en la <span class="negrita">consola de Firebase</span>.</p>
   <figure><img src="UD12/images/ud_Firebase-2024-03-20-14-00-31.png" /><br><figcaption>desde Android Studio</figcaption></figure>
   <br>
   
<figure><img src="UD12/images/ud_Firebase-2024-03-20-13-59-31.png" /><br><figcaption>desde Firebase Console</figcaption></figure>
<br>

<p>Es recomendable centralizar el identificador en el archivo strings.xml</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-18-57-35.png" /><br><figcaption></figcaption></figure>
<br>

<p>A continuación, se muestra un ejemplo de cómo registrar al usuario utilizando las credenciales que ya tiene almacenadas en el dispositivo:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-18-59-06.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-18-59-22.png" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez registrado el usuario se podrá consultar en la consola de Firebase:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-01-59.png" /><br><figcaption></figcaption></figure>
<br>

<p>Cuando se registra a un usuario con este método en la aplicación, <span class="negrita">el dispositivo recuerda este registro y lo mantiene autenticado aunque cierre la aplicación</span>,
  si no se realiza el cierre de sesión.</p>

<p>Para cerrar la sesión totalmente en la aplicación se debe usar el siguiente código:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-02-56.png" /><br><figcaption></figcaption></figure>

</section><!-- End section Autenticación-->

<!--*********************************************************Notificaciones***********************************************************-->
<section class="apartado">
<a name="sNotificaciones"></a>
<h2>Notificaciones</h2>
<p>Firebase ofrece un sistema de notificaciones para las aplicaciones llamado <span class="r-word">Messaging</span>.</p>

<p>Gracias a <span class="r-word">Messaging</span> desde la consola de Firebase se pueden enviar notificaciones a los dispositivos que tengan la aplicación instalada.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-04-12.png" /><br><figcaption></figcaption></figure>
<br>

<p>Se debe añadir la siguiente dependencia en <span class="inline-file">build.gradle.kts (Module)</span> y sincronizar.</p>

<p>Además se debe añadir el siguiente código en el <span class="negrita">manifiesto</span> 
  dentro de la etiqueta <span class="negrita">application</span> para permitir las notificaciones en segundo plano:</p>

  <figure><img src="UD12/images/ud_Firebase-2024-03-26-19-06-10.png" /><br><figcaption></figcaption></figure>
  <br>
  
  <p>Por último, se necesita crear la clase indicada en el manifiesto, para ello se crea una clase Kotlin nueva llamada <span class="inline-file">MyFirebaseMessagingService.kt</span>:</p>

  <section><pre><code class="language-kotlin">class MyFirebaseMessagingService: FirebaseMessagingService() {

    override fun onNewToken(token:String){
        super.onNewToken(token)
    }


    override fun onMessageReceived(remoteMessage: RemoteMessage) {
        super.onMessageReceived(remoteMessage)

        //Tratar la notificación FIREBASE recibida
        remoteMessage.notification?.let { message ->
            //A través de la variable message se puede acceder a toda la información de la notificación recibida

            //Se indica que al pulsar la notificsación se navegue a la MainActivity de la aplicación
            val intent = Intent(this, MainActivity::class.java).apply {
                addFlags(FLAG_ACTIVITY_CLEAR_TOP)
            }

            //variable necesaria para que muestre la notifciación sin estar en el contexto de la aplicación
            val pendingIntent = PendingIntent.getActivity(this, 0, intent, PendingIntent.FLAG_IMMUTABLE)

            //Construcción de la notificación de Android
            val channelID = "Firebase Example"
            val channelName = "Example Notification"
            val notificationBuilder = NotificationCompat.Builder(this, channelID)
                .setContentTitle(message.title)
                .setContentText(message.body)
                .setPriority(NotificationCompat.PRIORITY_HIGH)
                .setSmallIcon(R.drawable.ic_launcher_foreground)
                .setAutoCancel(false)
                .setContentIntent(pendingIntent)

            //Optención del administrador de notificaciones del sistema Android
            val manager = getSystemService(NOTIFICATION_SERVICE) as NotificationManager

            //Si el dispositivo tienen una versión superior a OReo se debe crear un canal de notificaciones
            // en caso contrario no es necesario
            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.O){
                val channel = NotificationChannel(channelID, channelName, NotificationManager.IMPORTANCE_HIGH)
                manager.createNotificationChannel(channel)
            }

            //Se indica a Android que genere la notificación en el dispositivo.
            //Al crear la notificación se necesita un identificador, en el ejemplo se genera de manera aleatoria
            manager.notify(Random.nextInt(), notificationBuilder.build())

        }


    }
}</code></pre>
  </section><br><br>
  
  <p>El método <span class="r-word">onNewToken</span> servirá para recibir notificaciones en un dispositivo específico.</p>
  
  <p>El método <span class="r-word">onMessageReceived</span> servirá para:
    <ul>
      <li>Recibir notificaciones generales de Firebase.</li>
      <li>Crear las notificaciones que se mostrarán en el dispositivo.</li>
    </ul>
  </p>
  
<h3>Enviar notificaciones desde la consola de Firebase</h3>
  <p>Para poder enviar notificaciones se debe crear una campaña desde la consola de Firebase:</p>
  
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-09-07.png" /><br><figcaption></figcaption></figure>
<br>
<p>Se puede enviar una <span class="negrita">notificación push</span> a <span class="negrita">todos los dispositivos</span> con la aplicación instalada.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-09-48.png" /><br><figcaption></figcaption></figure>
<br>

<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-10-24.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-11-05.png" /><br><figcaption>Consola Firebase</figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-11-24.png" /><br><figcaption>Dispositivo</figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-11-53.png" /><br><figcaption>Logcat</figcaption></figure>
<br>

<h3>Notificaciones Push Generales</h3>
<p>El ejemplo anterior funciona para dispositivos con las versiones de Android inferiores a la 13.</p>

<p>A partir de la versión 13 el usuario debe otorgar explícitamente permisos de recepción de notificaciones en tiempo de ejecución.</p>

<p>Para implementar esto se deben realizar los siguientes cambios al código.</p>
<p>Se necesita crear una configuración a nivel de aplicación para las notificaciones, 
  para ello se crea la clase <span class="d-word">AndroidFirebaseApp</span> en un archivo llamado <span class="inline-file">AndroidFirebaseApp.kt</span>:</p>
<section><pre><code class="language-kotlin">class AndroidFirebaseApp: Application() {
    override fun onCreate() {
        super.onCreate()
        
        val channelID = "FirebaseExample"
        val channelName = "Example notification"
        val manager = getSystemService(NOTIFICATION_SERVICE) as NotificationManager
        
        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.O){
            val channel = NotificationChannel(channelID, channelName, NotificationManager.IMPORTANCE_HIGH)
            manager.createNotificationChannel(channel)
        }
    }
}</code></pre>
</section><br><br>

<p>En el <span class="negrita">manifiesto</span>  se añaden los permisos para las notificaciones y se registra la clase anterior:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-22-02.png" /><br><figcaption></figcaption></figure>
<br>

<p>La documentación de Firebase aconseja añadir al manifiesto dentro de la etiqueta application el siguiente código para unificar la apariencia de las notificaciones:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-23-15.png" /><br><figcaption></figcaption></figure>
<br>

<p>Se deberán indicar los recursos correctos para la aplicación: icono existente en la carpeta drawable y color y nombre de canal como valores centralizados.</p>

<p>Es habitual pedir los permisos al iniciar la aplicación, en la clase MainActivity se debe añadir:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-43-31.png" /><br><figcaption></figcaption></figure>
<br>

<p>Al ejecutar la aplicación si no se han otorgado los permisos, aparecerá un mensaje como el siguiente:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-44-04.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-44-19.png" /><br><figcaption></figcaption></figure>
<br>


<h3>Notificaciones Push a un único dispositivo</h3>

<p>En la clase <span class="d-word">MyFirebaseMessaginService</span> se encuentra el método <span class="r-word">onNewToken</span> 
  que se ejecuta la primera vez que se utiliza la aplicación ya que <span class="negrita">se ha registrado esta clase como servicio en el manifiesto</span>.</p>

<p>De esta manera se genera un <span class="negrita">token</span> único para cada dispositivo en el que se instale la aplicación.</p>

<p>Este token se puede almacenar para posteriormente usarlo para enviar notificaciones a un dispositivo concreto.</p>

<p>Para enviar una notificación a un único dispositivo desde la consola de Firebase, 
  al crear una nueva campaña se debe elegir "<span class="negrita">Enviar mensaje de prueba</span>" y en la ventana que aparece se debe añadir el token:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-46-27.png" /><br><figcaption></figcaption></figure>
<br>

<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-46-41.png" /><br><figcaption></figcaption></figure>
<br>
<p>En una aplicación real cada token se debería almacenar en una preferencia y cuando el usuario se autentifique en la aplicación se debería guardar el token junto a sus datos.</p>

<p>De esta manera con alguna aplicación externa se podrían seleccionar todos los usuarios que se quiera y enviar notificaciones directamente a ellos mediante su token.</p>

<p>Esta funcionalidad es más avanzada y no se verá en este curso.</p>


<h3>Notificaciones Push por temas</h3>

<p>Es posible enviar notificaciones push solo a determinados dispositivos haciendo uso de los <span class="negrita">temas</span> (topics).</p>

<p>Para ello es necesario que los dispositivos estén suscritos a un tema, para ello en el código de la aplicación se debe añadir lo siguiente:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-48-14.png" /><br><figcaption></figcaption></figure>
<br>

<p>Se puede usar la técnica que se quiera para crear los temas, por ejemplo, detectar la versión de Android instalada, la ubicación del dispositivo…</p>

<p>A la hora de crear la campaña desde Firebase se debe elegir la opción <span class="negrita">Tema</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-49-13.png" /><br><figcaption></figcaption></figure>
<br>

<h3>Notificaciones In-App</h3>
<p>Se puede enviar una <span class="negrita">notificación In-App</span> (dentro de la aplicación) directamente a todos los dispositivos con la aplicación instalada.</p>

<p>Para ahorrar recursos Firebase solo recupera una vez al día los mensajes desde el servidor para las notificaciones In-App.</p>

<p>Se debe añadir las siguientes dependencias en <span class="inline-file">build.gradle.kts (Module)</span>S y sincronizar.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-50-26.png" /><br><figcaption></figcaption></figure>
<br>
<p>Desde la consola de Firebase se debe elegir la opción adecuada dependiendo de si ya se ha iniciado una campaña o no.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-53-05.png" /><br><figcaption></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-19-53-18.png" /><br><figcaption></figcaption></figure>
<br>
<p>Según la documentación:</p>

<p>"Para ahorrar energía, Firebase In-App Messaging solo recupera mensajes del servidor una vez al día.
  Eso puede dificultar las pruebas, por lo que Firebase console te permite especificar un dispositivo de prueba que muestra mensajes a pedido."</p>

<p>En la propia documentación se explica cómo <a class="enlace" target="_blank" href="https://firebase.google.com/docs/in-app-messaging/get-started?hl=es&platform=android#send_a_test_message_2">enviar mensajes In-App a un dispositivo de prueba</a></p>

<p>Para que funcionen correctamente las notificaciones In-App se deberá dar permiso al proyecto desde Google Cloud iniciando sesión con la misma cuenta que se utiliza en 
  la consola de Firebase.</p>
<p><a class="enlace" target="_blank" href="https://console.cloud.google.com/apis/api/firebaseinappmessaging.googleapis.com">https://console.cloud.google.com/apis/api/firebaseinappmessaging.googleapis.com</a></p>

<h3>Enviar información extra en la notificación</h3>
<p>Al crear una notificación desde Firebase se puede añadir <span class="negrita">datos extra</span> con el <span class="negrita">formato clave-valor</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-20-00-53.png" /><br><figcaption></figcaption></figure>
<br>
<p>Esta información se recibe junto con la notificación.</p>
<p>En el método donde se trata la notificación se pueden recuperar los datos extra enviados en la notificación.</p>

<p>Si la aplicación está abierta se podrán usar los datos directamente.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-26-20-01-33.png" /><br><figcaption></figcaption></figure>
<br>
<p>Si la aplicación está cerrada, se pueden añadir los datos recibidos a la notificación para cuando se abra la aplicación al pulsar la notificación estén disponibles esos datos:</p>

<section class="marco-t file-">
  <span class="icono file"> </span> <span class="negrita">MyFirebaseMessagingService.kt</span>
  </section>
<section class="marco-b">
    <figure><img src="UD12/images/ud_Firebase-2024-03-26-20-02-23.png" /><br><figcaption></figcaption></figure>
    <br>
    
</section>

<section class="marco-t file-">
  <span class="icono file"> </span> <span class="negrita">MainActivity.kt</span>
  </section>
<section class="marco-b">
    <figure><img src="UD12/images/ud_Firebase-2024-03-26-20-02-48.png" /><br><figcaption></figcaption></figure>
    <br>
    
</section>

<p>Recibir datos en la notificación se puede utilizar por ejemplo para:
  <ul>
    <li>Dependiendo de un valor recibido se podría navegar a una pantalla u otra de la aplicación.</li>
    <li>Dependiendo de los valores recibidos se pueden mostrar unos botones u otros en la notificación.</li>
    <li>Cualquier otra funcionalidad que se pueda necesitar.</li>
    <li>…</li>
  </ul>
</p>

</section><!-- End section Notificaciones-->

<!--*********************************************************Crashlytics***********************************************************-->
<section class="apartado">
<a name="sCrashlytics"></a>
<h2>Crashlytics</h2>

  <p><span class="d-word">Crashlytics</span> es una herramienta que permite obtener información y
    estadísticas de los errores producidos durante la ejecución de la aplicación</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-06-15.png" /><br><figcaption></figcaption></figure>
  <br>
  <p>Al pulsar el botón Agregar SDK aparecen las instrucciones para añadir Crashlytics a la aplicación.</p>
  
  <p><span class="inline-file">Añadir en build.gradle.kts (Project):</span></p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-06-58.png" /><br><figcaption></figcaption></figure>
  <br>
  <p>Al pulsar el botón Agregar SDK aparecen las instrucciones para añadir Crashlytics a la aplicación.

<span class="inline-file">Añadir en build.gradle.kts (Module)</span>:
</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-07-27.png" /><br><figcaption></figcaption></figure>
  <br>
  
  <p>Al pulsar el botón <span class="negrita">Agregar SDK</span> aparecen las instrucciones para añadir <span class="d-word">Crashlytics</span> a la aplicación.

  Para <span class="negrita">finalizar</span> la configuración de Crashlytics se debe <span class="negrita">iniciar la aplicación y forzar un error</span>.</p>
    
  <p>De esta manera en la consola de Firebase ya se podrán consultar todos los informes de error que se produzcan.</p>
  
  <p>Una manera de forzar un error es, como ya sabemos, lanzar una excepción:</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-09-07.png" /><br><figcaption></figcaption></figure>
  <br>
  <p>En la <span class="negrita">consola de Firebase Crashlytics</span> se pueden ver todos los errores producidos.
<span class="negrita">Incluso se indica el archivo y la línea donde se produjo el fallo.</span> 
</p>
  <figure><img src="UD12/im
    ages/ud_Firebase-2024-03-29-11-10-03.png" /><br><figcaption></figcaption></figure>
  <br>
  <p>Si se <span class="negrita">pulsa en un error</span> se mostrará <span class="negrita">más información</span> del mismo, 
    pudiendo ver incluso la pila de errores generados tal y como se pueden observar en Android Studio.</p>
  
  <p>Se puede enviar información extra cuando se utiliza Crashlytics:</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-11-24.png" /><br><figcaption></figcaption></figure>
  <br>
  <p>Se pueden añadir tantos pares <span class="cursiva">clave-valor</span> como se quiera usando tantas veces como se quiera el método <span class="r-word">setCustomKey</span>
     o todos de golpe usando el método <span class="r-word">setCustomKeys</span>.</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-11-49.png" /><br><figcaption></figcaption></figure>
  
</section><!-- End section Crashlytics-->

<!--*********************************************************Configuración remota***********************************************************-->
<section class="apartado">
<a name="sConfiguracionRemota"></a>
<h2>Configuración remota</h2>

<p>Generalmente cuando se <span class="negrita">realizan cambios</span> en una aplicación móvil hay que <span class="negrita">desplegar una nueva versión</span>
   de la aplicación en la tienda de aplicaciones.</p>

<p>Firebase ofrece la herramienta <span class="d-word">Remote Config</span> mediante la cual desde la consola de Firebase se podrán crear parámetros 
  y posteriormente actualizar sus parámetros. De esta manera, consultando los parámetros desde la aplicación se podrán realizar cambios en la misma.</p>

<p>Gracias a <span class="d-word">Remote Config</span>, por ejemplo, entre otras tareas se podrá cambiar el texto de un elemento, decidir si un elemento se debe mostrar o no…</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-14-11.png" /><br><figcaption></figcaption></figure>
<br>
<p>Las configuraciones permitidas serán pares clave-valor.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-14-32.png" /><br><figcaption></figcaption></figure>
<br>

<h3>Ejemplo: mostrar/ocultar botón</h3>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-15-04.png" /><br><figcaption></figcaption></figure>
<br>
<p>Tras realizar cambios en los parámetros creados en <span class="negrita">Remote Config</span> 
  se debe pulsar el botón Publicar cambios para que la aplicación acceda a los cambios realizados.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-15-53.png" /><br><figcaption></figcaption></figure>
<br>
<p>Para poder acceder desde la aplicación a la configuración creada en <span class="negrita">Remote Config</span>:
  <ul>
    <li>Se debe añadir en <span class="inline-file">build.gradle.kts (Module)</span>:
      <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-16-59.png" /><br><figcaption></figcaption></figure>
    </li>
    <li>Se debe acceder a la configuración mediante los métodos de la clase <span class="r-word">FirebaseRemoteConfig</span>
      <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-17-09.png" /><br><figcaption></figcaption></figure>
    </li>
  </ul>
</p>

<p>Dependiendo del valor almacenado en Firebase Remote Config se mostrará o no el botón de registro con Google.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-18-11.png" /><br><figcaption></figcaption></figure>
<br>

<p>Dependiendo del valor almacenado en Firebase Remote Config se mostrará o no el botón de registro con Google.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-19-52.png" /><br><figcaption></figcaption></figure>
<br>
<p>Si existen varios parámetros configurados en Remote Config a la hora de crear los valores por defecto <span class="negrita">se deben añadir al map todas las claves</span>:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-20-36.png" /><br><figcaption></figcaption></figure>
<br>
<p>Cuando se crean los pares clave-valor en Remote Config se puede marcar la opción "Usar la configuración predeterminada en la app".</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-21-03.png" /><br><figcaption></figcaption></figure>
<br>
<p>De esta manera se podrá descargar un <span class="negrita">archivo xml</span> con dicha configuración y así evitar crear a mano el <span class="negrita">mapa</span> con los valores por defecto.</p>

<p>Se debe descargar el archivo xml desde Remote Congif de Firebase:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-23-50.png" /><br><figcaption></figcaption></figure>
<br>


<p>Y posteriormente añadir el archivo <span class="negrita">xml</span> a la carpeta <span class="inline-folder">res/xml</span> y usarlo en el método <span class="r-word">setDefaultsAsync</span>:</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-22-08.png" /><br><figcaption></figcaption></figure>
<br>



</section><!-- End section Configuración remota-->


<!--*********************************************************Bases de datos***********************************************************-->
<section class="apartado">
<a name="sBases_de_datos"></a>
<h2>Bases de datos</h2>
<p>Firebase ofrece dos herramientas para el uso de bases de datos, las dos opciones implementan bases de datos <span class="negrita">NoSQL</span> (no relacionales).
<ul>
<li><span class="negrita">Realtime Database</span>: <ul>
  <li>Versión clásica de la herramienta.</li>
  <li>Cada base de datos es un archivo con JSON.</li>
  <li>El acceso a los datos puede ser lento cuando el volumen de datos es alto.</li>
</ul> </li>
<li><span class="negrita">Firestore Database</span>: 
<ul>
  <li>Versión optimizada de Realtime Database.</li>
  <li>Almacena los datos en varios archivos JSON repartidos en Colecciones, documentos y datos. 
    A su vez cada elemento dentro puede contener cualquiera de los demás (un dato puede ser una colección).</li>
</ul></li>
</ul>
</p>





          
<p>Firebase ofrece una encuesta que puede ayudar al desarrollador a seleccionar la mejor opción en cuanto a las necesidades de la aplicación: 
  <a class="enlace" target="_blank" href="https://firebase.google.com/docs/database/rtdb-vs-firestore">https://firebase.google.com/docs/database/rtdb-vs-firestore</a>
</p>


<h3>Realtime Database</h3>
<p>En el siguiente ejemplo se va a utilizar la versión Realtime:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-28-45.png" /><br><figcaption></figcaption></figure>
<br>

<p>Al crear la base de datos se debe seleccionar la <span class="negrita">ubicación</span> y las <span class="negrita">reglas de seguridad</span>.</p>

<p>Las reglas de seguridad indican si el usuario debe estar registrado en la aplicación con Firebase para poder hacer uso de la base de datos.</p>

<p>En este caso se elegirá el <span class="negrita">modo de prueba</span> pero posteriormente se pueden cambiar.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-30-14.png" /><br><figcaption></figcaption></figure>
<br>

<p>En la <a class="enlace" target="_blank" href="https://firebase.google.com/docs/firestore/security/get-started">documentación</a> 
  e puede encontrar más información sobre las reglas de seguridad.</p>

  <p>La primera base de datos se crea con el nombre por defecto en base al proyecto de Firebase:</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-31-58.png" /><br><figcaption></figcaption></figure>
  <br>
  
  <p>Para las siguientes habrá que indicar un nombre:</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-32-27.png" /><br><figcaption></figcaption></figure>
  <br>
  
  <p>Para realizar los ejemplos siguientes es posible que sea necesario cambiar las reglas de seguridad a <span class="negrita">true</span>
     (modo de prueba: el usuario no está registrado en la aplicación):</p>

     <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-34-34.png" /><br><figcaption></figcaption></figure>
     <br>
     
  <p>En esta ocasión se iniciará la base de datos importando los datos desde un archivo en formato JSON llamado <span class="inline-file">usuarios.json</span>.</p>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-35-09.png" /><br><figcaption></figcaption></figure>
  <br>
  <figure><img src="UD12/images/ud_Firebase-2024-03-29-11-35-19.png" /><br><figcaption></figcaption></figure>
  <br>
  
<p>Una vez importado el archivo se podrán ver los datos en la consola:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-35-48.png" /><br><figcaption></figcaption></figure>
<br>
<p>Para representar estos datos en la aplicación se necesita una data class llamada <span class="d-word">User</span> en un archivo llamado <span class="inline-file">User.kt</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-36-31.png" /><br><figcaption></figcaption></figure>
<br>
<p>La propiedad <span class="negrita">key</span> servirá para almacenar la clave del registro, en el ejemplo sería el valor <span class="negrita">0</span></p>

<p>El siguiente paso será añadir en <span class="inline-file">build.gradle.kts (Module)</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-37-40.png" /><br><figcaption></figcaption></figure>
<br>

<p>A continuación, desde el código se necesita un objeto de la clase FirebaseDatabase para poder acceder a la base de datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-37-48.png" /><br><figcaption></figcaption></figure>
<br>

<p>Si la conexión se va a realizar a una base de datos diferente a la de por defecto se debe indicar la ruta completa a la base de datos de Firebase:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-38-04.png" /><br><figcaption></figcaption></figure>
<br>

<p>Para poder usar la base de datos se necesita una <span class="negrita">referencia a la colección de datos</span>.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-38-32.png" /><br><figcaption></figcaption></figure>
<br>
<p>Con la referencia a la colección se indica la colección donde se realizarán todas las acciones de lectura, guardado, modificación y borrado.</p>

<p>Si la colección no existe en Realtime Database, cuando se guarda el primer elemento en con esa referencia se creará la colección.</p>

<p class="sub-section">Añadir elementos a la colección</p>
<p>Para añadir elementos a la colección y que se almacenen en la base de datos se pueden usar dos métodos sobre la referencia a la base de datos:
  <ul>
    <li><span class="negrita">child</span>: se le debe indicar la clave del elemento a añadir</li>

    <li><span class="negrita">push</span>: se asignará una clave aleatoria al elemento a añadir. Tras añadir el elemento se podrá recuperar la clave.</li>
  </ul>
</p>

<p>Si la <span class="negrita">clave no existe</span> se <span class="negrita">almacena el elemento</span> en la base de datos.</p>
<p>Si la <span class="negrita">clave ya existe</span> se <span class="negrita">modifica el elemento</span> en la base de datos.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-41-09.png" /><br><figcaption>Método <span class="negrita">Child</span></figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-41-41.png" /><br><figcaption>Se puede usar el método <span class="negrita">push</span> para obtener una clave aleatoria</figcaption></figure>
<br>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-42-52.png" /><br><figcaption>Método <span class="negrita">Push</span></figcaption></figure>
<br>

<p class="sub-section">Recuperar todos los datos una vez</p>
<p>Se debe usar el capturador de eventos <span class="r-word">addListenerForSingleValueEvent</span> 
  y en él crear un objeto <span class="r-word">ValueEventListener</span> con los métodos <span class="r-word">onDataChange</span> y <span class="r-word">onCancelled</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-43-47.png" /><br><figcaption></figcaption></figure>
<br>
<p>El evento <span class="negrita">recupera toda la colección de datos</span> almacenada en Realtime Database.</p>

<p>El evento solo se ejecuta una vez por lo que puede usarse al cargar la Activity (aplicación).</p>

<p class="sub-section">Recuperar todos los datos cada vez que se produce un cambio</p>

<p>Se debe usar el capturador de eventos <span class="r-word">addValueEventListener</span>
   y en él crear un objeto <span class="r-word">ValueEventListener</span> con los métodos <span class="r-word">onDataChange</span> y <span class="r-word">onCancelled</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-45-28.png" /><br><figcaption></figcaption></figure>
<br>


<p>El evento <span class="negrita">recupera toda la colección de datos</span> almacenada en Realtime Database.</p>

<p>El evento <span class="negrita">se ejecuta la primera vez y cada vez que se produce un cambio en los datos</span></p>

<p class="sub-section">Obtener la clave de un elemento</p>
<p>Si se necesita la clave de un elemento, en cualquiera de los capturadores de eventos vistos anteriormente se puede obtener la clave:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-46-25.png" /><br><figcaption></figcaption></figure>
<br>


<p>En el ejemplo, se utiliza la clave para asignarla a la propiedad id del objeto User.</p>

<p class="sub-section">Recuperar un único objeto cuando se realiza una acción sobre él</p>
<p>Se debe utiliza el capturador de eventos método <span class="r-word">addChildEventListener</span>
   y en él crear los métodos <span class="r-word">onChildAdded</span>, <span class="r-word">onChildChanged</span>, <span class="r-word">onChildRemoved</span>, 
   <span class="r-word">onChildMoved</span> y <span class="r-word">onCancelled</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-47-25.png" /><br><figcaption></figcaption></figure>
<br>
<p>El evento <span class="negrita">recupera solo el elemento añadido/modificado/eliminado/movido</span>.</p>

<p>El evento <span class="negrita">se ejecuta la primera vez y cada vez que se produce un cambio en los datos</span>.</p>

<p class="sub-section">Eliminar un elemento</p>

<p>Para eliminar un elemento se necesita su clave:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-48-25.png" /><br><figcaption></figcaption></figure>
<br>


<h3>Firestore Database</h3>

<p>En el siguiente ejemplo se va a utilizar la versión <span class="d-word">Firestore</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-53-56.png" /><br><figcaption></figcaption></figure>
<br>
<p>Al crear la base de datos se debe elegir la ubicación donde se almacenarán los datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-54-44.png" /><br><figcaption></figcaption></figure>
<br>
<p>A continuación, se deben elegir las reglas de seguridad de la misma, en este caso se elegirá el <span class="negrita">modo de prueba</span>
   pero posteriormente se pueden cambiar.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-55-14.png" /><br><figcaption></figcaption></figure>
<br>
<p>Una vez creada la base de datos desde la consola de Firebase se pueden crear <span class="negrita">colecciones</span> y <span class="negrita">documentos</span> con los datos.</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-55-45.png" /><br><figcaption></figcaption></figure>
<br>
<p>En el ejemplo se va a <span class="negrita">crear una colección, añadir, editar y eliminar datos</span> desde el código de la aplicación.</p>
<p>El primer paso es añadir en <span class="inline-file">build.gradle.kts (Module)</span>:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-56-47.png" /><br><figcaption></figcaption></figure>
<br>
<p>A continuación, en <span class="d-word">MainActivity</span> se necesita un objeto de la clase <span class="r-word">FirebaseFirestore</span> para poder acceder a la base de datos:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-57-10.png" /><br><figcaption></figcaption></figure>
<br>

<p class="sub-section">Almacenar datos</p>

<p>Para <span class="negrita">almacenar datos</span> en la base de datos se utilizan anidados los métodos:
<ul>
  <li><span class="negrita">collection</span> para indicar la colección de datos donde almacenar los datos.</li>
  <li><span class="negrita">document</span> para indicar el nombre del documento donde guardar los datos que en el ejemplo será el mail introducido.</li>
  <li><span class="negrita">set</span> para indicar mediante un map los pares clave-valor a almacenar.</li>
</ul></p>

<p>Cada vez que se pulse el botón si no existe el email se creará un documento con los datos introducidos. Si el email existe se actualizarán los datos introducidos.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-11-58-42.png" /><br><figcaption></figcaption></figure>
<br>
<p>Los datos <span class="negrita">añadidos</span> se almacenan de la siguiente manera, se crea una <span class="negrita">colección</span> llamada <span class="negrita">users</span>,
  se utiliza como <span class="negrita">nombre del documento</span> el <span class="negrita">correo electrónico</span> introducido y dentro del documento se almacenan el resto de valores introducido:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-12-00-13.png" /><br><figcaption></figcaption></figure>
<br>

<p class="sub-section">Recuperar datos</p>

<p>Para <span class="negrita">recuperar datos</span> de la base de datos se utiliza el método <span class="r-word">get</span> de la siguiente manera:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-12-01-08.png" /><br><figcaption></figcaption></figure>
<br>

<p>Gracias a <span class="r-word">addOnSuccessListener</span> se pueden realizar acciones si se consigue el documento indicado.</p>

<p>Las variables usadas en el código podrían ser las variables de estado usadas en componentes Text para que se rellenen al conseguir los datos de la base de datos.</p>

<p class="sub-section">recuperar todos los datos de una colección</p>

<p>Para <span class="negrita">recuperar todos los datos de una colección</span> de la base de datos se utiliza el método <span class="negrita">get</span> de la siguiente manera:</p>
<figure><img src="UD12/images/ud_Firebase-2024-03-29-12-03-33.png" /><br><figcaption></figcaption></figure>
<br>

<p class="sub-section">Eliminar datos </p>
<p>Para <span class="negrita">eliminar datos</span> de la base de datos se utiliza el método <span class="r-word">delete</span> sobre el objeto de la base de datos.</p>

<figure><img src="UD12/images/ud_Firebase-2024-03-29-12-04-48.png" /><br><figcaption></figcaption></figure>
<br>


</section><!-- End section Bases de datos-->
  <!---BTM_MENU--->
  <script src="../script/prism.js"></script>
</body>

</html>